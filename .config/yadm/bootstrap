#/bin/bash

echo "Updating system"
sudo zypper ref && sudo zypper dup

echo "Installing core dev tools"
sudo zypper install -t pattern devel_basis
sudo zypper in \
    wget \
    ripgrep \
    ripgrep-bash-completion \
    bat \
    nodejs-default \
    npm \
    yarn \
    exa \
    ruby \
    python \
    python3 \
    git \
    hub \
    tig \
    tmux

if ! command -v nvim &> /dev/null; then
    echo "Installing neovim nightly"
    mkdir -p ~/.local/bin
    wget -O nvim https://github.com/neovim/neovim/releases/download/nightly/nvim.appimage
    sudo chmod u+x nvim
fi

if ! python3 -c "import pynvim" &> /dev/null; then
    echo "Installing NeoVim python remote plugin"
    sudo pip3 install pynvim
fi

if ! command -v fzf &> /dev/null; then
    echo "Installing fzf"
    git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf
    ~/.fzf/install --all
fi

if [ ! -d ~/.tmux/plugins/tpm ]; then
    echo "Installing tmux plugin manager (tpm)"
    git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
fi

if ! command -v fff &> /dev/null; then
    echo "Installing fast file finder (fff)"
    git clone https://github.com/dylanaraps/fff ~/.fff
    sudo make -C ~/.fff install
fi

if [ ! -f ~/.bash_completion.d/complete_alias ]; then
    echo "Installing complete-alias"
    mkdir -p ~/.bash_completion.d
    curl https://raw.githubusercontent.com/cykerway/complete-alias/master/complete_alias > ~/.bash_completion.d/complete_alias
fi

if ! npm list --depth 1 --global neovim &> /dev/null; then
    echo "Installing neovim npm remote plugin"
    sudo npm install -g neovim
fi

if ! command -v lazygit &> /dev/null; then
    echo "Installing lazygit"
    sudo zypper ar https://download.opensuse.org/repositories/home:Dead_Mozay/openSUSE_Tumbleweed/home:Dead_Mozay.repo
    sudo zypper ref
    sudo zypper in lazygit
fi

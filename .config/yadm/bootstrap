#/bin/bash

echo "Updating system"
sudo zypper ref && sudo zypper dup

echo "Installing core dev tools"
sudo zypper install -t pattern devel_basis
sudo zypper in -y \
    wget \
    fuse \
    ripgrep \
    ripgrep-bash-completion \
    bat \
    nodejs-default \
    npm \
    yarn \
    exa \
    ruby \
    python \
    python2-pip \
    python3 \
    python3-pip \
    git \
    hub \
    tig \
    tmux

if ! command -v dotnet &> /dev/null; then
    echo "Installing dotnet"
    sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
    wget https://packages.microsoft.com/config/opensuse/15/prod.repo
    sudo mv prod.repo /etc/zypp/repos.d/microsoft-prod.repo
    sudo chown root:root /etc/zypp/repos.d/microsoft-prod.repo
    sudo zypper in -y libicu67 aspnetcore-runtime-3.1
fi

if ! command -v nvim &> /dev/null; then
    if [[ ! -z "$WSL_DISTRO_NAME" ]]; then
        echo "Installing Neovim"
        sudo zypper in -y neovim python3-neovim
    else
        echo "Installing neovim nightly"
        mkdir -p ~/bin
        wget -O ~/bin/nvim https://github.com/neovim/neovim/releases/download/nightly/nvim.appimage
        sudo chmod u+x ~/bin/nvim
    fi
fi

if ! python3 -c "import pynvim" &> /dev/null; then
    echo "Installing NeoVim python remote plugin"
    sudo pip3 install pynvim
fi

if ! command -v fzf &> /dev/null; then
    echo "Installing fzf"
    git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf
    ~/.fzf/install --all
fi

if [ ! -d ~/.tmux/plugins/tpm ]; then
    echo "Installing tmux plugin manager (tpm)"
    git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
fi

if ! command -v fff &> /dev/null; then
    echo "Installing fast file finder (fff)"
    git clone https://github.com/dylanaraps/fff ~/.fff
    sudo make -C ~/.fff install
fi

if ! npm list --depth 1 --global neovim &> /dev/null; then
    echo "Installing neovim npm remote plugin"
    sudo npm install -g neovim
fi

if ! command -v lazygit &> /dev/null; then
    echo "Installing lazygit"
    sudo zypper ar https://download.opensuse.org/repositories/home:Dead_Mozay/openSUSE_Tumbleweed/home:Dead_Mozay.repo
    sudo zypper ref
    sudo zypper in -y lazygit
fi
